## Houmao Mac 客户端使用说明

本文件介绍当前 MVP 版本 Houmao Mac 客户端的使用方式，包含启动方式、全局快捷键、主窗口与历史记录窗口的交互。

---

## 1. 启动应用

- 使用 Xcode 运行：
  - 打开 `mac/houmao/houmao.xcodeproj`。
  - 选择 Scheme `houmao`，设备为 `My Mac`。
  - `Cmd + R` 运行，应用启动后主窗口会出现在前台。

- 打包为独立 App（可选后续）：
  - 在 Xcode 中使用 `Product -> Archive`，导出 `.app` 或 `.dmg`，以便直接在 Finder 中启动。

---

## 2. 主窗口（输入 + LLM 回复）

- **位置**：应用启动后自动显示，也可以通过全局快捷键唤醒（见第 3 节）。
- **输入框**：
  - 在顶部单行输入框中输入问题或指令。
  - 按回车或点击 `Send` 按钮发送。
- **LLM 回复区**：
  - 下方区域会显示最近一轮的问答：
    - `You: <你的问题>`
    - `LLM: <模型回复>`（当前为本地 mock，将来会接入 MiniCPM-V）。

> 说明：目前只保留一轮最近对话，不做多轮对话上下文历史展示。

---

## 3. 全局快捷键（显示 / 收起主窗口）

- 系统范围内（任意 App 中），快速连续按两次：
  - **双击 Option 键**

- 行为：
  - 如果 Houmao 主窗口当前不可见：
    - 激活应用并将主窗口置顶显示。
  - 如果主窗口已经可见：
    - 收起主窗口。

- 检测机制：
  - 两次按下 Option 键的间隔需在 0.4 秒内。
  - 支持左右 Option 键（键码 58 或 61）。

> 注意：首次使用需要在系统设置中为应用授予”辅助功能”权限，以便监听全局键盘事件。

---

## 4. 查看历史“使用情况”记录（history 命令）

- 在主窗口顶部输入框中输入：
  - `history`
  - 然后按回车。

- 行为：
  - 不会调用 LLM。
  - 会弹出一个独立的历史记录窗口，展示本机采集的“使用情况”：
    - 时间戳（精确到分钟）。
    - 前台应用名称（例如：`Xcode`、`Safari`）。
    - 对应时间段内你输入的一段文本（过长时会被截断显示）。

- 历史数据来源：
  - 由 `UsageTracker` 模块自动采集：
    - 监听前台应用切换。
    - 监听全局键盘输入，将连续输入到回车为止的文本视为一条记录。
  - 数据以 JSON 格式保存在本地：
    - 路径：`~/Documents/houmao-logs/usage-history.json`

---

## 5. 清空所有历史记录

- 在历史记录窗口右下角，有一个按钮：
  - `Clear All History`

- 点击后：
  - 立即清空本地 `usage-history.json` 中的所有记录。
  - 当前窗口中的列表刷新为空。

> 当前版本未做二次确认，点击即清空，请谨慎操作。

---

## 6. 隐私与权限说明（当前版本）

- **数据存储位置**：
  - 所有“使用情况”记录都仅保存在本机 `~/Documents/houmao-logs/usage-history.json` 文件中。
  - 不会自动上传到任何远程服务器。

- **键盘监听与前台应用检测**：
  - 通过 macOS 的全局事件监听和 `NSWorkspace` 实现。
  - 若后续版本需要更深入的可访问性访问（如读取控件内容），需要在系统设置中为应用开启“辅助功能”权限。

后续如有功能调整（例如引入真实 LLM 调用、更多命令或 UI 改动），请同步更新本文件，保证使用方式与实现保持一致。 

